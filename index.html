<!DOCTYPE html>
<html>
  <head>
    <script src="qtest.js"></script>
    <script src="q.js"></script>
    <script>
      /* Setup test resources */
      const LIST__0__URL = 
      "/myApp/_api/lists(guid'List0-UnreadableId')" +
      "/items?$filter=ID eq 2379&$select=ID,OData_" +
      "List0_UnreadableColumnName,OData_List0_Unre" +
      "adableExpandedColumnName/ID,OData_List0_Unr" +
      "eadableExpandedColumnName/OData_List1_Unrea" +
      "dableColumnName&$expand=OData_List0_Unreada" +
      "bleExpandedColumnName";

      const LIST__1__URL = 
      "/myApp/_api/lists(guid'List1-UnreadableId')" +
      "/items?$filter=ID eq 123&$select=ID,OData_" +
      "List1_UnreadableColumnName";

      const CONTEXT__URL = '/myApp/_api/contextinfo';
      
      QResource(resource => resource === CONTEXT__URL, () => {
        return {
          d: {
            GetContextWebInformation: {
              FormDigestValue: 'bqtoYJgeiMgRtiDW',
              FormDigestTimeoutSeconds: 1800
            }
          }
        }
      })
      
      QResource(resource => resource === LIST__0__URL, () => {
        return {
          d: {
            results: [
              {
                ID: 2379,
                OData_List0_UnreadableColumnName: "Bob",
                OData_List0_UnreadableExpandedColumnName: { results: [] }
              }
            ]
          }
        }
      });

      QResource(resource => resource === LIST__1__URL, () => {
        return {
          d: {
            results: [
              {
                ID: 123,
                OData_List1_UnreadableColumnName: "Alice"
              }
            ]
          }
        }
      });

      /* Configuration */
      Q.config({app: 'myApp'});

      const List1Query = Q(
        /* Expandable list can be query itself. */
        'List1-UnreadableId',
        {
          Id: 'ID',
          Name: 'OData_List1_UnreadableColumnName'
        }
      );

      /* Query template generated by qgen.js */
      const List0Query = Q(
        'List0-UnreadableId', 
        { /* xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx */
          Id: 'ID',
          Name: 'OData_List0_UnreadableColumnName', /*OData__x0000__x0000__x0000__x0000__x00 */
          Expanded: ['OData_List0_UnreadableExpandedColumnName', List1Query ]
        }
      );

      List0Query.get(`${List0Query.Id} eq 2379`).then(data => console.log(data));
      List1Query.get(`${List1Query.Id} eq 123`).then(data => console.log(data));

      List1Query.post([
        {ID: 777, OData_List1_UnreadableColumnName: "Ben"},
      ]);

      List1Query.batch([
        {ID: 111, OData_List1_UnreadableColumnName: "John"},
        {ID: 222, OData_List1_UnreadableColumnName: "Jim"} 
      ]);
      
    </script>
  </head>
  <body></body>
</html>
